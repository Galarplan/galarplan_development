<?xml version="1.0" encoding="utf-8"?>
<odoo>

 <record id="account_saving_search_view" model="ir.ui.view">
      <field name="name">account.saving.search.view</field>
      <field name="model">account.saving</field>
      <field name="arch" type="xml">
        <search>
                      <field name="id" string="# ID" />

          <field name="company_id" />
            <field name="name"/>
            <field name="partner_id"/>
                  <field name="start_date"  />
                      <field name="end_date"  />
            <separator/>
            <filter name="filter_draft" string="Borrador" domain="[('state', '=', 'draft')]"/>
<filter name="filter_open" string="Publicado" domain="[('state', '=', 'open')]"/>
<filter name="filter_close" string="Cerrado" domain="[('state', '=', 'close')]"/>
<filter name="filter_cancel" string="Cancelado" domain="[('state', '=', 'cancel')]"/>
 <separator/>
 <filter name="filter_draft" string="Borrador" domain="[('state_plan', '=', 'draft')]"/>
            <filter name="filter_posted" string="Publicado" domain="[('state_plan', '=', 'posted')]"/>
            <filter name="filter_active" string="Activo" domain="[('state_plan', '=', 'active')]"/>
            <filter name="filter_adjudicated_with_assets" string="Adjudicado con Bien" domain="[('state_plan', '=', 'adjudicated_with_assets')]"/>
            <filter name="filter_adjudicated_without_assets" string="Adjudicado sin Bien" domain="[('state_plan', '=', 'adjudicated_without_assets')]"/>
            <filter name="filter_awarded" string="Adjudicado" domain="[('state_plan', '=', 'awarded')]"/>
            <filter name="filter_pending_authorizated" string="AutorizaciÃ³n de Retiro Pendiente" domain="[('state_plan', '=', 'pending_authorizated')]"/>
            <filter name="filter_anulled" string="Anulado" domain="[('state_plan', '=', 'anulled')]"/>
            <filter name="filter_disabled" string="Desactivado" domain="[('state_plan', '=', 'disabled')]"/>
            <filter name="filter_retired" string="Retirado" domain="[('state_plan', '=', 'retired')]"/>
            <filter name="filter_cancelled" string="Cancelado" domain="[('state_plan', '=', 'cancelled')]"/>
            <filter name="filter_closed" string="Cerrado" domain="[('state_plan', '=', 'closed')]"/>

            <separator/>
                <filter string="Sin Facturas" name="filter_without_invoice" domain="[('invoice_count', '=', 0)]"/>
                <filter string="Sin Pagos" name="filter_without_payment" domain="[('payments_count', '=', 0)]"/>
                <group expand="1" string="Group By">
                    <filter string="Cliente" name="groupby_partner_id" context="{'group_by': 'partner_id'}"/>
                    <filter string="Tipo" name="groupby_saving_type" context="{'group_by': 'saving_type'}"/>
                    <filter string="Empresa" name="groupby_company" context="{'group_by': 'company_id'}"/>
                    <filter string="Estado" name="groupby_state" context="{'group_by': 'state'}"/>
<filter string="Diario" name="groupby_journal" context="{'group_by': 'journal_id'}"/>

                    <filter string="Estado del Plan" name="groupby_state_plan" context="{'group_by': 'state_plan'}"/>

                </group>
        </search>
      </field>
    </record>


    <record id="account_saving_tree_view" model="ir.ui.view">
      <field name="name">account.saving.view</field>
      <field name="model">account.saving</field>
      <field name="arch" type="xml">
        <tree decoration-danger="state=='open'"
        decoration-info="state=='draft'"
              decoration-success="state=='close'"
              decoration-muted="state=='cancel'"
        >


            <field name="id" string="# ID" optional="hide"/>
          <field name="company_id" optional="show"/>
            <field name="name"/>
            <field name="partner_id"/>
          <field name="saving_type"  optional="show"/>
                <field name="start_date"  optional="show" />
                      <field name="end_date"  optional="show"/>
               <field name="saving_amount"/>
          <field name="periods"  optional="show"/>
            <field name="por_pagar"  readonly="1" optional="show"/>
                  <field name="pagos"  readonly="1" optional="show"/>
                  <field name="pendiente"  readonly="1" optional="show"/>
 <field name="invoice_count"  optional="show"/>
             <field name="payments_count"  optional="show"/>
          <field name="currency_id" invisible="1"/>
           <field name="state"  optional="show"/>
            <field name="state_plan" optional="hide"/>
        </tree>
      </field>
    </record>
 


    <record id="account_saving_form_view" model="ir.ui.view">
      <field name="name">account_saving.form.view</field>
      <field name="model">account.saving</field>
      <field name="arch" type="xml">
        <form>
          <header>


              <button name="action_open"
                      string="Aprobar" icon="fa-check"
                      type="object"
                      attrs="{'invisible':[('state','not in',('draft',))]}"
                      />

               <button name="%(action_account_saving_payment_wizard)d"
                      string="Registrar Pago" icon="fa-money"
                      type="action"
                      attrs="{'invisible':[('state','not in',('open',))]}"
                      />


              <button name="action_draft"
                      string="Reversar" icon="fa-rotate-left"
                      type="object"
                      attrs="{'invisible':[('state','not in',('open',))]}"
                      />

              <button name="action_cancel"
                      string="Anular" icon="fa-times"
                      type="object"
                      attrs="{'invisible':[('state','not in',('draft','posted'))]}"
                      />


             <field name="state" widget="statusbar"/>
          </header>
          <sheet>
            <div class="oe_title">
              <h1>
                <field name="name" required='1' attrs="{'readonly':[('state','!=','draft')]}"/>
              </h1>
            </div>
              <group colspan="2">
                <group col="2" >

<field name="id" string="# ID" readonly="1"  attrs="{'invisible':[('id','&lt;=',0)]}"/>




                  <field name="saving_type" required='1' attrs="{'readonly':[('state','!=','draft')]}"/>
                   <field name="saving_plan_id"
                          options="{'no_create':True,'no_edit':True}"
                          domain="[('state','=','posted'),('saving_type','=',saving_type)]" required='1' attrs="{'readonly':[('state','!=','draft')]}"/>
               <field name="partner_id"   options="{'no_create':True,'no_edit':True}" required='1' attrs="{'readonly':[('state','!=','draft')]}"/>

                      <field name="seller_id" required="1"
                        options="{'no_edit':True,'no_create':True,'no_edit':True}"
                             attrs="{'readonly':[('state','!=','draft')]}"
                      />
                      <field name="start_date"  required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>
                      <field name="end_date"  required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>


                    </group>
                <group col="2">
               <field name="company_id" options="{'no_create':True,'no_edit':True,'no_open':True,}" required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>
                  <field name="currency_id" invisible="1" options="{'no_create':True,'no_edit':True,'no_open':True,}"/>
                           <field name="info_migrate" readonly="1" attrs="{'readonly':[('state','!=','draft')]}" />

    <field name="periods"   attrs="{'readonly':[('state','!=','draft')]}"/>
                  <field name="saving_amount"  required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>
                  <field name="fixed_amount"  required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>
                  <field name="quota_amount"  required="1"
                             attrs="{'readonly':[('state','!=','draft')]}"/>

<field name="por_pagar"  readonly="1" />
                  <field name="pagos"  readonly="1" />
                  <field name="pendiente"  readonly="1" />
                

                </group>
              </group>
            <notebook>
                <page string="Cuotas">
                    <group colspan="4">
                         <button name="action_open_lines" colspan="1"
                      string="Actualizar" icon="fa-search"
                      type="object" invisible="1"
                      attrs="{'invisible':[('state','not in',('draft',))]}"
                      />
                    </group>
                    <newline/>
                   <field name="line_ids" context="{'tree_view_ref':'planes_ahorro.account_saving_lines_tree_view','default_parent_saving_state':state}">




                   </field>



                </page>
                 <page string="Pagos">
                   <field name="payment_ids">

                   </field>
                     <newline/>
                     <separator string="Historial de Pagos" attrs="{'invisible':[('historic_payment_ids','=',[])]}"/>
                     <field name="historic_payment_ids" attrs="{'invisible':[('historic_payment_ids','=',[])]}" readonly="1">
                         <tree string="Historial">
                            <field name="payment_journal_name" />
                        <field name="payment_date"  />
                        <field name="payment_ref"  />
                        <field name="amount" sum="total"/>
                         </tree>
                     </field>
                 </page>
  <page string="Facturas">
         <field name="invoice_ids" readonly="1">

                   </field>
                     <newline/>
                     <separator string="Historial de Facturas" attrs="{'invisible':[('historic_invoice_ids','=',[])]}"/>
                     <field name="historic_invoice_ids" attrs="{'invisible':[('historic_invoice_ids','=',[])]}" readonly="1">
                         <tree string="Historial">
                               <field name="saving_line_id" options="{'no_open':True,'no_create':True,'no_edit':True}"/>
                            <field name="type" />
                        <field name="invoice_date"  />
                        <field name="invoice_ref"  />
                        <field name="amount" sum="total"/>
                             <field name="invoice_state" />
                         </tree>

                         <form string="Historial">
                             <group>
                                <group>
                                     <field name="saving_line_id" options="{'no_open':True,'no_create':True,'no_edit':True}"/>
                            <field name="type" />
                        <field name="invoice_date"  />
                        <field name="invoice_ref"  />
                                </group>
                                 <group>
                                   <field name="amount" />
                             <field name="invoice_state" />
                                 </group>
                             </group>


                         </form>

                     </field>
                 </page>
              <page string="Contrato">
                   <group colspan="2">
                <group col="2" >
                           <field name="partner_signed_id"/>
                     <field name="partner_signed_date"/>

                        </group>
                     <group col="2" >
                         <field name="company_signed_id"/>
                     <field name="company_signed_date"/>
                         <field name="interest_expenses_account_id"/>

                        </group>



              </group>
<newline/>
                  <group>
                      <field name="state_plan" widget="radio" />
                  </group>
                </page>
<page string="Configuracion">
    <group>
         <group>
       <field name="journal_id" options="{'no_create':True,'no_edit':True,'no_open':True,}"
                             attrs="{'required':[('info_migrate','!=',True)],'readonly':[('state','in',('close','cancel'))]}" />
                  <field name="document_type_id" options="{'no_create':True,'no_edit':True,'no_open':True,}" readonly="1" force_save="1"/>
           <field name="analytic_account_id"  options="{'no_create':True,'no_edit':True,'no_open':True,}"/>


    </group>
         <group>
           <field name="rate_inscription" readonly="1" force_save="1"/>
                   <field name="rate_expense" readonly="1" force_save="1"/>
                   <field name="rate_insurance" readonly="1" force_save="1"/>
                   <field name="rate_decrement_year" readonly="1" force_save="1"/>

                  <field name="old_ref_id" readonly="1"
       attrs="{'invisible': [('old_ref_id', 'in', [False, '', None])]}"/>

    </group>

    </group>
</page>
            </notebook>
          </sheet>
        </form>
      </field>

    </record>

    <record id="account_saving_action" model="ir.actions.act_window">
      <field name="name">Planes de Ahorro</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">account.saving</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'search_default_filter_draft':1,'search_default_filter_open':1,'search_default_filter_close':1}</field>
      <field name="domain">[]</field>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">
          Click to create a new record.
        </p>
      </field>
    </record>


  
</odoo>