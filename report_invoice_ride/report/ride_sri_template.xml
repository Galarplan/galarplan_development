<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="ride_sri_template">
        <t t-call="web.basic_layout">
            <t t-raw="0" />
            <div class="page" style="margin: 0; padding: 10mm;">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="report_invoice_ride.ride_sri_header" />
                    <t t-call="report_invoice_ride.ride_sri_body" />
                </t>
            </div>
        </t>
    </template>

    <!-- <template id="ride_sri_header">
        <div class="invoice-header" style="margin: 10px;">
            <table style="width: 100%; border-collapse: separate; font-size: 12px;">
                <tr>
                    <td
                        style="border: 1px solid black; padding: 10px; width: 60%; text-align: center;">
                        <p style="font-weight: bold; font-size: 16px; color: red;">NO TIENE LOGO</p>
                    </td>
                </tr>
                <tr>
                   
                    <td style="border: 1px solid black; padding: 10px;">
                        <h4 style="letter-spacing: 2px;">
                            <span t-field="doc.company_id.l10n_ec_legal_name" />
                        </h4>
                        <div style="font-size: 12px;">
                            <strong>
                                <t
                                    t-if="doc.company_id.partner_id.l10n_latam_identification_type_id"
                                    t-esc="doc.company_id.partner_id.l10n_latam_identification_type_id.name"
                                    id="inv_tax_id_label" />
                                        <t t-else="">RUC/Cédula</t>: </strong>
                            <span
                                t-field="doc.company_id.partner_id.vat" />
                            <br />
                            <t
                                t-if="doc.journal_id.l10n_ec_emission">
                                <strong>Direccion: </strong>
                                <span
                                    t-esc="doc.journal_id.l10n_ec_emission_address_id._display_address()" />
                                <br />
                            </t>
                            <t t-if="doc.company_id.l10n_ec_special_taxpayer_number">
                                <strong>Contribuyente especial numero: </strong>
                                <span t-field="doc.company_id.l10n_ec_special_taxpayer_number" />
                                <br />
                            </t>

                            <strong>Obligado a llevar contabilidad: </strong>
                            <t
                                t-if="doc.company_id.l10n_ec_forced_accounting">Si</t>
                            <t t-else="">
                                No</t>
                            <br />
                            <t
                                t-if="doc.company_id.l10n_ec_withhold_agent_number">
                                <strong>Agente de retencion No.: </strong>
                                <span t-field="doc.company_id.l10n_ec_withhold_agent_number" />
                                <br />
                            </t>
                            <t
                                t-if="doc.company_id.l10n_ec_regime == 'rimpe'"> Contribuidor Rimpe <br />
                            </t>
                        </div>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="border: 1px solid black; padding: 10px; width: 40%;">
                        <p>
                            <strong>
                                <t
                                    t-if="doc.company_id.partner_id.l10n_latam_identification_type_id"
                                    t-esc="doc.company_id.partner_id.l10n_latam_identification_type_id.name"
                                    id="inv_tax_id_label" />
                                <t t-else="">RUC/Cédula</t>: </strong>
                            <span t-field="doc.company_id.partner_id.vat" />
                        </p>
                        <p>
                            <strong>FACTURA</strong>
                        </p>
                        <p>
                            <strong>No.:</strong>
                            <t t-esc="doc.l10n_latam_document_number or ''" />
                        </p>
                        <p>
                            <strong>NÚMERO DE AUTORIZACIÓN</strong>
                        </p>
                        <p>
                            <t t-esc="doc.l10n_ec_authorization_number or ''" />
                        </p>
                        <p>
                            <strong>FECHA DE FACTURA:</strong>
                        </p>
                        <p>
                            <t t-esc="doc.invoice_date or ''" />
                        </p>
                        <p>
                            <strong>AMBIENTE:</strong>
                            <t t-if="doc.company_id.l10n_ec_production_env">Produccion</t>
                            <t t-else="">Pruebas</t>
                        </p>
                        <p><strong>EMISIÓN:</strong> NORMAL</p>
                        <p>
                            <strong>CLAVE DE ACCESO:</strong>
                        </p>
                        <div class="text-justify">
                            <img style="width:100%; height:15.5mm;"
                                t-att-src="'/report/barcode/Code128/' + doc.l10n_ec_authorization_number"
                                alt="Missing barcode for authorization number"
                            />
                        </div>
                        <div class="text-center" style="font-size: 12px">
                            <span t-field="doc.l10n_ec_authorization_number" />
                        </div>

                    </td>
                </tr>
            </table>
        </div>

    </template> -->

    <template id="ride_sri_header">
        <div class="invoice-header" style="margin: 10px;">
            <table style="width: 100%; border-collapse: separate; font-size: 12px;">
                <tr>
                    <!-- Columna Izquierda: NO TIENE LOGO y Datos de la Empresa -->
                    <td
                        style="width: 60%; vertical-align: top; padding-right: 10px;">
                        <!-- Logo -->
                        <div
                            style="text-align: center; padding: 10px; height: 150px; align-content: center;">
                            <p style="font-weight: bold; font-size: 16px; color: red;">NO TIENE LOGO</p>
                        </div>
                        <!-- Datos de la Empresa -->
                        <div
                            style="padding: 10px; height: 300px; border: 1px solid black; border-radius: 10px;">
                            <h4 style="letter-spacing: 2px;">
                                <span t-field="doc.company_id.l10n_ec_legal_name" />
                            </h4>
                            <p>
                                <strong>RUC:</strong>
                                <span t-field="doc.company_id.partner_id.vat" />
                            </p>
                            <p>
                                <strong>Dirección Matriz:</strong>
                                <t t-esc="doc.company_id.partner_id.street or ''" />
                            </p>
                            <p>
                                <strong>Obligado a llevar contabilidad:</strong>
                                <t t-if="doc.company_id.l10n_ec_forced_accounting">Sí</t>
                                <t t-else="">No</t>
                            </p>
                            <p>
                                <t t-if="doc.company_id.l10n_ec_special_taxpayer_number">
                                    <strong>Contribuyente Especial No.:</strong>
                                    <span t-field="doc.company_id.l10n_ec_special_taxpayer_number" />
                                </t>
                            </p>
                        </div>
                    </td>

                    <!-- Columna Derecha: Datos de la Factura -->
                    <td
                        style="width: 40%; border: 1px solid black; vertical-align: top; padding: 10px; border-radius: 10px;">
                        <p>
                            <strong>R.U.C.:</strong>
                            <t t-esc="doc.company_id.partner_id.vat" />
                        </p>
                        <p>
                            <strong>FACTURA</strong>
                        </p>
                        <p>
                            <strong>No.:</strong>
                            <t t-esc="doc.l10n_latam_document_number or ''" />
                        </p>
                        <p>
                            <strong>NÚMERO DE AUTORIZACIÓN:</strong>
                        </p>
                        <p>
                            <t t-esc="doc.l10n_ec_authorization_number or ''" />
                        </p>
                        <p>
                            <strong>FECHA DE FACTURA:</strong>
                            <t t-esc="doc.invoice_date or ''" />
                        </p>
                        <p>
                            <strong>AMBIENTE:</strong>
                            <t t-if="doc.company_id.l10n_ec_production_env">Producción</t>
                            <t t-else="">Pruebas</t>
                        </p>
                        <p><strong>EMISIÓN:</strong> NORMAL</p>
                        <p>
                            <strong>CLAVE DE ACCESO:</strong>
                        </p>
                        <div style="text-align: center;">
                            <img style="width: 100%; height: auto;"
                                t-att-src="'/report/barcode/Code128/' + doc.l10n_ec_authorization_number"
                                alt="Código de Barras" />
                            <p style="font-size: 10px; word-wrap: break-word;">
                                <span t-field="doc.l10n_ec_authorization_number" />
                            </p>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- Datos del Cliente -->
            <table
                style="width: 100%; border: 1px solid black; border-collapse: collapse; margin-top: 10px;">
                <tr>
                    <td style="padding: 10px;">
                        <p>
                            <strong>Cliente:</strong>
                            <t t-esc="doc.partner_id.name or ''" />
                        </p>
                        <p>
                            <strong>Dirección:</strong>
                            <t t-esc="doc.partner_id.contact_address or ''" />
                        </p>
                        <p>
                            <strong>Identificación:</strong>
                            <t t-esc="doc.partner_id.vat or ''" />
                        </p>
                        <p>
                            <strong>Teléfono:</strong>
                            <t t-esc="doc.partner_id.phone or ''" />
                        </p>
                    </td>
                </tr>
            </table>
        </div>
    </template>


    <!-- <template id="ride_sri_body">
        <div>
            
            <table>
                <thead>
                    <tr>
                        <th>Descripción</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="doc.invoice_line_ids" t-as="line">
                        <td>
                            <t t-esc="line.name" />
                        </td>
                        <td>
                            <t t-esc="line.quantity" />
                        </td>
                        <td>
                            <t t-esc="line.price_unit" />
                        </td>
                        <td>
                            <t t-esc="line.price_total" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </template> -->

    <template id="ride_sri_body">

        <t t-set="display_discount" t-value="any(l.discount for l in doc.invoice_line_ids)" />

        <table class="table table-sm o_main_table " name="invoice_line_table">
            <thead>
                <tr>
                    <th name="th_description" class="text-start">
                        <span>Descripcion</span>
                    </th>
                    <th name="th_quantity" class="text-end">
                        <span>Cantidad</span>
                    </th>
                    <th name="th_priceunit"
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span>Precio Unitario</span>
                    </th>
                    <th name="th_price_unit" t-if="display_discount"
                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span>Desc.%</span>
                    </th>
                    <th name="th_taxes"
                        t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                        <span>Imp.</span>
                    </th>
                    <th name="th_subtotal" class="text-end">
                        <span groups="account.group_show_line_subtotals_tax_excluded">Subtotal</span>
                        <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                    </th>
                </tr>
            </thead>
            <tbody class="invoice_tbody">
                <t t-set="current_subtotal" t-value="0" />
                <t t-set="lines"
                    t-value="doc.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" />

                <t t-foreach="lines" t-as="line">
                    <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                        groups="account.group_show_line_subtotals_tax_excluded" />
                    <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                        groups="account.group_show_line_subtotals_tax_included" />

                    <tr
                        t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                        <t t-if="line.display_type == 'product'"
                            name="account_invoice_line_accountable">
                            <td name="account_invoice_line_name">
                                <span t-field="line.name" t-options="{'widget': 'text'}" />
                            </td>
                            <td class="text-end">
                                <span t-field="line.quantity" />
                                <span t-field="line.product_uom_id" groups="uom.group_uom" />
                            </td>
                            <td
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.price_unit" />
                            </td>
                            <td t-if="display_discount"
                                t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span class="text-nowrap" t-field="line.discount" />
                            </td>
                            <t t-set="taxes"
                                t-value="', '.join([(tax.description or tax.name) for tax in line.tax_ids])" />
                            <td name="td_taxes"
                                t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }} {{ 'text-nowrap' if len(taxes) &lt; 10 else '' }}">
                                <span t-out="taxes" id="line_tax_ids">Tax 15%</span>
                            </td>
                            <td class="text-end o_price_total">
                                <span class="text-nowrap" t-field="line.price_subtotal"
                                    groups="account.group_show_line_subtotals_tax_excluded" />
                                <span class="text-nowrap" t-field="line.price_total"
                                    groups="account.group_show_line_subtotals_tax_included" />
                            </td>
                        </t>
                        <t t-if="line.display_type == 'line_section'">
                            <td colspan="99">
                                <span t-field="line.name" t-options="{'widget': 'text'}" />
                            </td>
                            <t t-set="current_section" t-value="line" />
                            <t t-set="current_subtotal" t-value="0" />
                        </t>
                        <t t-if="line.display_type == 'line_note'">
                            <td colspan="99">
                                <span t-field="line.name" t-options="{'widget': 'text'}" />
                            </td>
                        </t>
                    </tr>

                    <t
                        t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">
                        <tr class="is-subtotal text-end">
                            <td colspan="99">
                                <strong class="mr16">Subtotal</strong>
                                <span
                                    t-esc="current_subtotal"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                />
                            </td>
                        </tr>
                    </t>
                </t>
            </tbody>
        </table>
        <div class="clearfix mb-4">
            <div id="total" class="row">
                <div
                    t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ms-auto">
                    <table class="table table-sm"
                        style="page-break-inside: avoid;">

                        <!--Tax
                                        totals-->
                        <t t-set="tax_totals" t-value="doc.tax_totals" />
                        <t t-call="account.document_tax_totals" />

                        <!--Payments-->
                        <t t-if="print_with_payments">
                            <t t-if="doc.payment_state != 'invoicing_legacy'">
                                <t t-set="payments_vals"
                                    t-value="doc.sudo().invoice_payments_widget and doc.sudo().invoice_payments_widget['content'] or []" />
                                <t t-foreach="payments_vals" t-as="payment_vals">
                                    <tr t-if="payment_vals['is_exchange'] == 0">
                                        <td>
                                            <i
                                                class="oe_form_field text-end oe_payment_label">Paid
                                                on <t t-esc="payment_vals['date']"
                                                    t-options='{"widget": "date"}' /></i>
                                        </td>
                                        <td class="text-end">
                                            <span t-esc="payment_vals['amount']"
                                                t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="len(payments_vals) > 0">
                                    <tr class="border-black fw-bold">
                                        <td>Amount Due</td>
                                        <td class="text-end">
                                            <span t-field="o.amount_residual" />
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </t>
                    </table>
                </div>
            </div>
        </div>

        <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'}">
            <table class="table table-sm" style="page-break-inside: avoid">
                <thead>
                    <tr>
                        <th class="text-center" colspan="2">Metodos de pago</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td t-esc="doc.l10n_ec_sri_payment_id.name" />
                        <td class="text-end">
                            <span
                                t-esc="sum(d['payment_total'] for d in doc._l10n_ec_get_payment_data())"
                                t-options='{"widget": "monetary", "display_currency": doc.currency_id}' />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <t t-set="additional_info" t-value="doc._l10n_ec_get_invoice_additional_info()" />
        <t t-call="l10n_ec_edi.report_invoice_additional_info" />
        <p
            t-if="doc.move_type in ('out_invoice', 'in_refund') and doc.payment_reference"
            name="payment_communication" class="mt-4"> Please use the following communication for
            your payment : <b>
                <span t-field="doc.payment_reference" />
            </b>
                        <t
                t-if="doc.partner_bank_id">
                <br /> on this account: <span t-field="doc.partner_bank_id"
                    class="fw-bold" />
            </t>
        </p>

    </template>

    <template id="ride_sri_footer">
        <div>
            <!-- Totales -->
            <p>Total: <t t-esc="doc.amount_total" /></p>
            <p>Gracias por su compra.</p>
        </div>
    </template>


    <template id="report_invoice_additional_info">
        <t t-if="additional_info">
            <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'}">
                <table class="table table-sm" style="page-break-inside: avoid">
                    <thead>
                        <tr>
                            <th class="text-center" colspan="2">Informacion Adicional</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="additional_info.items()" t-as="item">
                            <tr t-if="item[1]">
                                <td>
                                    <span t-esc="str(item[0])" />
                                </td>
                                <td>
                                    <span t-esc="str(item[1])" />
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </t>
    </template>


</odoo>